This README is available in both English and Portuguese (Brazilian Portuguese). You can access the Portuguese version [here](README-ptBR.md).

# Refactoring Technical Report

*Pokémon Crawler Project – Comparison Between Original Code and Refactored Version*

-----

## Auxiliary Documentation

1.  [Configuration and Installation Manual](docs/install.md)
2.  [Technical Documentation](docs/documentation.md)
3.  [Interactive Documentation](https://jeffersonspeck.github.io/refactor_eng_soft/)

## Summary

1.  [Links indicated by the professor](#1-links-indicated-by-the-professor)  
2.  [Overview of the new architecture](#2-overview-of-the-new-architecture)  
3.  [Key improvements over the original code](#3-key-improvements-over-the-original-code)  
4.  [Design patterns identified / applied](#4-design-patterns-identified--applied)  
5.  [Code smells & refactorings](#5-code-smells--refactorings)  
6.  [Strengths of the new solution](#6-strengths-of-the-new-solution)  
7.  [Opportunities for improvement and next steps](#7-opportunities-for-improvement-and-next-steps)  
8.  [Context and theoretical foundation](#8-context-and-theoretical-foundation)  
9.  [References](#9-references)
-----

## 1. Links Indicated by the Professor

| Description          | URL |
| -------------------- | --- |
| Recommended Reading  | [Book](https://engsoftmoderna.info/cap9.html) |
| Page Used in Class   | [URL](https://refactoring.guru/pt-br/refactoring/smells) |

-----

## 2. Overview of the New Architecture

```text
.
├── docs/             # various project documentation
├── logs/             # .txt files generated by the logger
├── models/           # domain entities
│   ├── pokemon.py
│   └── pokemon_builder.py
├── services/         # business rules and utilities
│   ├── csv_writer.py          # write csv
│   ├── csv_analyzer.py        # analyze csv
│   ├── logging.py             # central logging configuration
│   ├── pokemon_crawler.py     # crawler and parser
│   └── quests.py              # extra utilities (e.g., quests)
├── output/           # generated artifacts (pokemons.csv)
├── olds/             # old files before refactoring (Prof. Sidgley's originals)
└── main.py           # application entry point
```

### 2.1 Key Structural Differences

| **Aspect**              | **Original Code (`crawler-pokemon.py`)** | **Refactored Code**                                          | **Benefits / Impact**                                |
| ----------------------- | ---------------------------------------- | ------------------------------------------------------------ | ---------------------------------------------------- |
| **Folder Organization** | Single monolithic file                   | `models/`, `services/`, `logs/`, `output/`                   | Modularity, scalability, easier onboarding           |
| **Data Model**          | Generic `dict`                           | Immutable `@dataclass Pokemon`                               | Strong typing, safety, readability                   |
| **Object Creation**     | Scattered logic                          | *Builder* pattern via `PokemonBuilder`                       | Step-by-step validation, extensibility               |
| **Parsing & Crawling**  | One long function (`crawl_page`)         | `PokemonCrawler` with specialized methods (`fetch`, `parse`) | Lower cyclomatic complexity, SRP¹, testability       |
| **Logging**             | Single `logging.basicConfig` call        | `setup_logging()` with multiple handlers                     | Standardized, reusable, and filterable logs          |
| **Error Handling**      | Generic `except Exception`               | `ParsingError` + detailed logs with `exc_info`               | Easier debugging and traceability                    |
| **Output Organization** | CSV in project root                      | `output/pokemons.csv`                                        | Clear separation between artifacts and code          |
| **Post-crawl Analysis** | Not available                            | `csv_analyzer.py`                                            | Data consistency checks and useful statistics        |
| **CSV Export**          | Ad-hoc inline code                       | `write_pokemon_csv()` in `csv_writer.py`                     | Re-use, clarity, single responsibility               |
| **Extras / Narrative**  | Not available                            | `quests.py` adds random “quests”                             | Educational value, optional gamification for display |
| **Test Readiness**      | No structure                             | Classes with single responsibility                           | Unit tests via `pytest` are feasible and encouraged  |

¹ **SRP** – *Single Responsibility Principle* (each module/class has one clear reason to change).

-----
## 3. Key Improvements Over the Original Code

| Category               | Implemented Improvement                                               | Impact                                                      |
|------------------------|------------------------------------------------------------------------|--------------------------------------------------------------|
| **Architecture**       | Logical folders (`models`, `services`, `logs`, `output`)               | Facilitates scalability and onboarding for new developers    |
| **Domain**             | `Pokemon` as an immutable `@dataclass`                                 | Eliminates "Primitive Obsession," ensures attribute consistency |
| **Object Creation**    | `PokemonBuilder` allows step-by-step construction with validations     | Avoids giant constructors or too many optional parameters    |
| **Parsing**            | Specialized methods (`fetch_html`, `discover_pages`, `_parse_tables`)  | Reduces cyclomatic complexity and duplication                |
| **Logging**            | Centralized configuration (`logging.py`) + dedicated file in `logs/`   | More readable, filterable, and reusable logs                 |
| **Correct CSV**        | `Pokemon.to_dict()` standardizes column order                          | Corrects misalignment that occurred in the original          |
| **Analysis**           | `csv_analyzer.py` performs integrity checks and statistics              | Checks for duplicates, null values, type distribution        |
| **Preparation for Tests** | Each class has a single responsibility                               | Facilitates `pytest` suite creation                          |

-----

## 4. Design Patterns Identified / Applied

| Pattern                        | Location / Role                                                                                     |
| ------------------------------ | --------------------------------------------------------------------------------------------------- |
| **Builder**                    | `PokemonBuilder` – creation of complex objects without giant constructors.                          |
| **Facade / Utility**           | `PokemonCSVAnalyzer` – simplified interface for CSV inspection.                                     |
| **Factory Method (implicit)**  | `PokemonCrawler.crawl()` – decides how to instantiate `PokemonBuilder` according to HTML structure. |
| **Singleton (implicit)**       | Global logger configuration in `setup_logging()` – ensures a single `Logger` instance.              |

-----

## 5. Code Smells & Refactorings

### 5.1 General Map of Corrected Smells

| Code Smell (original)             | Solution / Refactoring                                    |
| --------------------------------- | --------------------------------------------------------- |
| **Long Method**                   | **Extract Method** + **Extract Class** (`PokemonCrawler`) |
| **Duplicated Code**               | `discover_pages`, `fetch_html` centralize HTTP access     |
| **Primitive Obsession**           | **Extract Class** `Pokemon`                               |
| **Global Variables**              | Removed                                                   |
| **Visible External Dependency**   | Centralized log configuration (`setup_logging`)           |
| **Lack of Null Checks**           | Guard-clauses at critical parsing points                  |

> **Note:** Some complementary structural improvements are also considered valid refactorings according to Fowler (2019), even without altering the program's logic. These include:
>
>   - **Adding docstrings and descriptive comments**, provided they increase code clarity and understanding;
>   - **Correcting indentation, formatting, and ambiguous names**, improving readability;
>   - **Moving code snippets between files** (e.g., extracting utility classes to separate modules), provided it preserves behavior and improves internal organization.

-----

## 6. Strengths of the New Solution

1.  **Clear separation of layers** (domain, services, application).
2.  **High cohesion**: each module does only one thing.
3.  **Actionable logs**: contextualized messages, facilitating troubleshooting.
4.  **Reliable data export**: CSV generated with correct columns and stable order.
5.  **Ready for unit tests**: minimal dependencies and easy mock injection.
6.  **Extensible to other websites**: just implement new parsing strategies.

-----

## 7. Opportunities for Improvement and Next Steps

| Topic                      | Recommended Action                                                                   |
| -------------------------- | ------------------------------------------------------------------------------------ |
| **Typing**                 | Use `pydantic` for model validation or `typing.Annotated`.                           |
| **Tests**                  | Implement `pytest` suite with \>80% coverage.                                        |
| **CI/CD**                  | Add *pre-commit* (black, isort, ruff) and GitHub Actions.                            |
| **Strategy Pattern**       | Allow crawlers for multiple Pokémon data sources.                                    |
| **Exception Handling**     | Replace generic `except Exception` with specific exceptions (`requests.exceptions`). |

-----

## 8. Context and Theoretical Foundation

The inspection and refactoring process was based on:

* **Fowler's Catalog** – Chapter 9 of the book *Engenharia de Software Moderna* (Modern Software Engineering) provides an adaptation of 11 essential refactorings (Extract Method, Inline Method, Extract Class, etc.) and guidelines for incremental application.
* **Code Smells Catalog** – Fowler (Chapter 7) defines low-quality code signals such as *Long Method*, *Primitive Obsession*, *Duplicated Code*, and others.
* **Design Patterns (GoF)** – *Builder* and *Facade* were employed to reduce coupling and expose clear APIs.

The conducted refactoring eliminates most code smells, improves complexity metrics, and prepares the project for future evolutions (new crawlers, database persistence, REST API, etc.).

-----

## 9. References

1.  Fowler, M. **Refactoring: Improving the Design of Existing Code**. 2nd ed. Addison-Wesley, 2019.
2.  Sommerville, I.; Munns, M. **Engenharia de Software Moderna**. Pearson, 2021 – Chap. 9 (Refactoring).
3.  Gamma, E.; Helm, R.; Johnson, R.; Vlissides, J. **Design Patterns: Elements of Reusable Object-Oriented Software**. Addison-Wesley, 1994.
4.  Official Docs – *Python Standard Library: logging*; *BeautifulSoup 4 Documentation*; *pandas User Guide*.

-----

### Final Remark

This document was prepared to serve as documentation for the refactoring work performed.

## License

This project is made available for **academic and educational use**, with permission to:

- Freely use the source code;
- Modify and adapt as needed;
- Share modified versions.

**Terms of Use**:

- It is mandatory to **cite the original authors**.
- In any redistribution or adaptation, visible credit must be included to:
  - [Edinéia dos Santos Brizola Brum](https://github.com/edibrum)  
  - [Jefferson Rodrigo Speck](https://github.com/jeffersonspeck)  
  - [Rafael Ferreira Lima](ferreira.rfl@gmail.com)
- The activity was originally proposed by Professor [Sidgley Camargo de Andrade](https://github.com/sidgleyandrade), and this should also be acknowledged in derivative versions.

This project **cannot be commercialized** or used for profit.

-----

## Authors

- [Edinéia dos Santos Brizola Brum](https://github.com/edibrum)  
- [Jefferson Rodrigo Speck](https://github.com/jeffersonspeck)  
- [Rafael Ferreira Lima](ferreira.rfl@gmail.com)

**Activity Proponent**: Prof. [Sidgley Camargo de Andrade](https://github.com/sidgleyandrade)